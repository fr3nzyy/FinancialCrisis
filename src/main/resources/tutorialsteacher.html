<html>
<style type="text/css">
    /* 13. Basic Styling with CSS */

    /* Style the lines by removing the fill and applying a stroke */
    .line {
        fill: none;
        stroke: #070000;
        stroke-width: 2;
    }

    .overlay {
        fill: none;
        pointer-events: all;
    }

    /* Style the dots by assigning a fill and stroke */
    .dot {
        fill: #ffab00;
        stroke: #fff;
    }

    .focus circle {
        fill: none;
        stroke: steelblue;
    }

</style>
<head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
<script>
    d3.json('http://localhost:8080/getLimit', function (data) {

        // 2. Use the margin convention practice
        var margin = {top: 50, right: 50, bottom: 50, left: 50}
            , width = window.innerWidth - margin.left - margin.right // Use the window's width
            , height = window.innerHeight - margin.top - margin.bottom; // Use the window's height


        var parseDate = d3.timeParse("%Y-%m-%d");
        var parsedData = data.map(function (d) {
            return {
                date: (parseDate(d.date)),
                close: d.close
            }
        });

        var closes = [];
        var dates = [];
        parsedData.forEach(element => {
            closes.push(element.close)
            dates.push(element.date)
        });

        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var xscale = d3.scaleTime()
            .domain(d3.extent(dates))
            .range([0, width - 100]);
        var x_axis = d3.axisBottom()
            .scale(xscale);
        var yscale = d3.scaleLinear()
            .domain([0, d3.max(closes)])
            .range([height / 2, 0]);
        var y_axis = d3.axisLeft()
            .scale(yscale);
        svg.append("g")
            .attr("transform", "translate(50, 10)")
            .call(y_axis);
        var xAxisTranslate = height / 2 + 10;
        svg.append("g")
            .attr("transform", "translate(50, " + xAxisTranslate + ")")
            .call(x_axis)

        var line = d3.line()
            .x(function(d) { return xscale(d.date); }) // set the x values for the line generator
            .y(function(d) { return yscale(d.close); }) // set the y values for the line generator
            .curve(d3.curveMonotoneX) // apply smoothing to the line

        const lines = svg.append("path")
            .datum(parsedData) // 10. Binds data to the line
            .attr("class", "line") // Assign a class for styling
            .attr("d", line); // 11. Calls the line generator

//---------------------------TOOLTIP----------------------------//

        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0)
            .style("position", "absolute");

//---------------------------POINTS-----------------------------//
        lines.selectAll("points")
            .data(function(d) {return d})
            .enter()
            .append("circle")
            .attr("cx", function(d) { return xscale(d.date); })
            .attr("cy", function(d) { return yscale(d.close); })
            .attr("r", 1)
            .attr("class","point")
            .style("opacity", 1);


    });
</script>
</body>
</html>