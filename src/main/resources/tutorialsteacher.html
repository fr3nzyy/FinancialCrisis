<html>
<head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
<script>

    // fetch('http://localhost:8080/get').then(data => {
    //     console.log(data.json())
    //     // fetchdata = data.json().map(function (d) {
    //     //     return {
    //     //         date: d3.timeParse("%Y-%m-%d")(d.date),
    //     //         close: d.close
    //     //     }
    //     // });
    // });
    // console.log(fetchdata);

    d3.json('http://localhost:8080/get', function (data) {
        var parseDate = d3.timeParse("%Y-%m-%d");
        var formatDate = d3.timeFormat("%Y-%m-%d");
        // parseDate('2003-01-01')
        // formatDate = d3.time.format("%Y-%m-%d")
        // formatDate(parseDate('2003-01-01'))
        parsedData = data.map(function (d) {
            return {
                date: (parseDate(d.date)),
                // date: formatDate(parseDate(d.date)),
                // date: d.date,
                close: d.close
            }
        });

        var width = 1500,
            height = 1000;

        var closes = [];
        var dates = [];
        parsedData.forEach(element => {
            closes.push(element.close)
            dates.push(element.date)
        });
        console.log(closes)
        console.log(dates)

        // var testdata = [10, 15, 20, 25, 30];
        // var parsedData = null;
        // console.log(parsedData);

        // Append SVG
        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);


        var xscale = d3.scaleTime()
            .domain(d3.extent(dates))
            .range([0, width - 100]);

        var yscale = d3.scaleLinear()
            .domain([0, d3.max(closes)])
            .range([height / 2, 0]);

        var x_axis = d3.axisBottom()
            .scale(xscale);

        var y_axis = d3.axisLeft()
            .scale(yscale);

        svg.append("g")
            .attr("transform", "translate(50, 10)")
            .call(y_axis);

        var xAxisTranslate = height / 2 + 10;

        svg.append("g")
            .attr("transform", "translate(50, " + xAxisTranslate + ")")
            .call(x_axis)

        svg.append("path")
            .datum(parsedData)
            .attr("fill", "none")
            .attr("stroke", "steelblue")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
                .x(function(d) { return x_axis(parsedData.date) })
                .y(function(d) { return y_axis(parsedData.close) })
            )

        // // Create scale
        // var scale = d3.scaleLinear()
        //     .domain([d3.min(closes), d3.max(closes)])
        //     .range([0, width - 100]);
        //
        // // Add scales to axis
        // var x_axis = d3.axisBottom()
        //     .scale(scale);
        //
        // var y_axis = d3.axisLeft()
        //     .scale(scale);
        //
        // //Append group and insert axis
        // svg.append("g")
        //     .call(x_axis);
    });
</script>
</body>
</html>